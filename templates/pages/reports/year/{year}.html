<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="dark">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.colors.min.css">
    <title>Last.fm Data Explorer</title>
  </head>
  <body>
    <main class="container">
      <h1>Yearly report ({{ year }})</h1>
      {% set start_timestamp = start_of_year(year | int) %}
      {% set end_timestamp = end_of_year(year | int) %}
      {% set top_artists = fetch_top_artists(start_timestamp, end_timestamp) %}
      {% set top_albums = fetch_top_albums(start_timestamp, end_timestamp) %}
      {% set top_tracks = fetch_top_tracks(start_timestamp, end_timestamp) %}
      <div class="grid">
        <div>    
          <h2>Top Artists</h2>
          <ol>
            {% for artist in top_artists %}
              <li>
                {{ artist.artist }}
                {% if artist.new %}
                <sup class="pico-color-red-500">New discovery</sup>
                {% endif %}
                ({{ artist.listens }})
              </li>
            {% endfor %}
          </ol>
        </div>
        <div>
          <h2>Top Ablums</h2>
          <ol>
            {% for album in top_albums %}
            <li>
              {{ album.name }} - {{ album.artist }}
              {% if album.new %}
                <sup class="pico-color-red-500">New discovery</sup>
              {% endif %}
            ({{ album.listens }})</li>
            {% endfor %}
          </ol>
        </div>
        <div>
          <h2>Top Tracks</h2>
          <ol>
            {% for track in top_tracks %}
            <li>
              {{ track.name }} - {{ track.artist }}
              {% if track.new %}
                <sup class="pico-color-red-500">New discovery</sup>
              {% endif %}
            ({{ track.listens }})</li>
            {% endfor %}
          </ol>
        </div>
      </div>
      {% set blast_artists = fetch_blast_artists(start_timestamp, end_timestamp) %}
      <div class="grid">
        <div>    
          <h2>Blasted from the past(ed)</h2>
          <ol>
            {% for artist in blast_artists %}
              <li>
                {{ artist.artist }}
                ({{ artist.current_listens }})
                <sup class="pico-color-yellow-300">
                  {{ years(artist.since) }} years
                </sup>
              </li>
            {% endfor %}
          </ol>
        </div>
    </main>
  </body>
</html>
